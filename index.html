<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Covid19Cue</title>
	<link rel="icon" href="img/icons/icon_256.png">
	<!-- set PWA -->
	<link rel="manifest" href="js/manifest.json">
	<meta name="theme-color" content="#38003c">
	<!-- end PWA -->
	<!-- iOS support -->
	<link rel="apple-touch-icon" href="img/icons/icon_256.png">
	<meta name="apple-mobile-app-status-bar" content="#38003c">
	<!-- end iOS support -->
	<meta name="author" content="David LS(RUCU)">
	<link rel="stylesheet" type="text/css" href="css/base.css">
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=2">
	<meta name="description" content="Get informed of the latest information on COVID19 pandemic. Such as overview on cases, how to prevent the spread, how to protect loved ones from the deadly virus, what to do when you suspect others or yourself having the virus and so on. Together we can fight off the deadly virus.">
	<!-- og tags -->
	<meta property="og:type" content="website">
	<meta property="og:title" content="Covid19Cue">
	<meta property="og:image" content="https://covid19cue.netlify.app/img/icons/icon_256.png">
	<meta property="og:url" content="https://covid19cue.netlify.app/">
	<meta property="og:description" content="Get informed of the latest information on COVID19 pandemic. Such as overview on cases, how to prevent the spread, how to protect loved ones from the deadly virus, what to do when you suspect others or yourself having the virus and so on. Together we can fight off the deadly virus.">
	<!-- ends og tags -->
</head>
<body>
	<header class="flex_middle theme_bg">
		<div class="app_icon"><img src="img/icons/icon_256.png" alt="corona virus icon" class="full_dims"></div>
	</header>
	<select id="select_country" onchange="loadStats(this.value)" class="full_w"></select>
	<main>
		<!-- numbers section -->
		<section class="case_numbers">
			<div class="case_container">
				<span id="total_confirmed_number">...</span>
				<span>Maambukizi</span>
			</div>
			<div class="case_container">
				<span id="new_confirmed_number">...</span>
				<span>Maambukizi mapya</span>
			</div>

			<div class="case_container">
				<span id="total_deaths_number">...</span>
				<span>Vifo</span>
			</div>
			<div class="case_container">
				<span id="new_deaths_number">...</span>
				<span>Vifo vipya</span>
			</div>

			<div class="case_container">
				<span id="total_reccovered_number">...</span>
				<span>Waliopona</span>
			</div>
			<div class="case_container">
				<span id="new_reccovered_number">...</span>
				<span>Waliopona wapya</span>
			</div>
			<div class="case_container">
				<span id="last_updated_number">...</span>
				<span>Last Updated</span>
			</div>
		</section>
	</main>
</body>
<script defer src="js/base.js"></script>
<script defer src="js/AsyncRequest.js"></script>
<script defer src="sw.js"></script>
<script>
	window.onload = () => {
		loadCountries();
		loadStats(`TZ`);
	};

	// loadCountries()
	function loadCountries () {
		const request = new AsyncRequest({
			'url': `js/countries.json`,
			'method': `get`
		});

		request.execute().then(response=> {
			if (response.status) {
				const data = JSON.parse(response.body);

				const countries = data.countries;
				for(i in countries) {
					// create new 'option' element, then add 'value' and 'text' attributes to it
					const country_options = document.createElement(`option`);
					country_options.value = countries[i].iso2;
					country_options.text = countries[i].name;

					// pre select tanzania option
					getNode('#select_country').value = `TZ`;

					// append the #country_options into #select_country
					getNode('#select_country').appendChild(country_options);
				}
			} else {
				// error occured
				console.log(response);
			}
		}).catch(error=>{
			// error occured
			console.log(error);
		});
	}

	// loadStats()
	function loadStats (location) {
		getNode('#total_confirmed_number').innerText=`...`;
		getNode('#new_confirmed_number').innerText=`...`;
		getNode('#total_reccovered_number').innerText=`...`;
		getNode('#new_reccovered_number').innerText=`...`;
		getNode('#total_deaths_number').innerText=`...`;
		getNode('#new_deaths_number').innerText=`...`;
		getNode('#last_updated_number').innerText=`...`;
		const request = new AsyncRequest({
			'url': `https://api.smartable.ai/coronavirus/stats/${location}`,
			'method': `get`,
			'headers': {
				'Cache-Control': `no-cache`,
				'Subscription-Key': `REPLACE_WITH_YOUR_API_KEY`
			}
		});

		request.execute().then(response=>{
			if (response.status) {
				const data = JSON.parse(response.body);
				// console.log(data);

				const updatedDateTime = new Date(data.updatedDateTime);
				const formated_date_time = `${updatedDateTime.getFullYear()}-${preppendZero((updatedDateTime.getMonth()+1))}-${preppendZero(updatedDateTime.getDate())} ${preppendZero(updatedDateTime.getHours())}:${preppendZero(updatedDateTime.getMinutes())}:${preppendZero(updatedDateTime.getSeconds())}`;

				getNode('#total_confirmed_number').innerText=data.stats.totalConfirmedCases;
				getNode('#new_confirmed_number').innerText=data.stats.newlyConfirmedCases;
				getNode('#total_reccovered_number').innerText=data.stats.totalRecoveredCases;
				getNode('#new_reccovered_number').innerText=data.stats.newlyRecoveredCases;
				getNode('#total_deaths_number').innerText=data.stats.totalDeaths;
				getNode('#new_deaths_number').innerText=data.stats.newDeaths;
				getNode('#last_updated_number').innerText=formated_date_time;
			} else {
				// error occured
				console.log(response);

				getNode('#total_confirmed_number').innerText=`-`;
				getNode('#new_confirmed_number').innerText=`-`;
				getNode('#total_reccovered_number').innerText=`-`;
				getNode('#new_reccovered_number').innerText=`-`;
				getNode('#total_deaths_number').innerText=`-`;
				getNode('#new_deaths_number').innerText=`-`;
				getNode('#last_updated_number').innerText=`-`;
			}
		}).catch(error=>{
			// error occured
			console.log(error);

			getNode('#total_confirmed_number').innerText=`-`;
			getNode('#new_confirmed_number').innerText=`-`;
			getNode('#total_reccovered_number').innerText=`-`;
			getNode('#new_reccovered_number').innerText=`-`;
			getNode('#total_deaths_number').innerText=`-`;
			getNode('#new_deaths_number').innerText=`-`;
			getNode('#last_updated_number').innerText=`-`;
		});
	}
</script>
</html>
